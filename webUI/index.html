<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>YouTube Archiver</title>
  <link rel="icon" href="app_icon.png" type="image/png">
  <link rel="apple-touch-icon" href="app_icon.png">
  <link rel="stylesheet" href="styles.css?v=1.2.0">
  <script defer src="app.js?v=1.2.0"></script>
</head>
<body>
  <div class="backdrop"></div>
  <header class="topbar">
    <div class="brand">
      <img class="app-icon" src="app_icon.png" alt="YouTube Archiver">
      <div class="brand-text">
        <div class="title">YouTube Archiver</div>
        <div class="subtitle">Self-hosted playlist archiving</div>
      </div>
    </div>
    <button id="nav-toggle" class="button ghost small nav-toggle" type="button" aria-expanded="false" aria-controls="primary-nav">
      Menu
    </button>
    <nav class="top-nav" id="primary-nav" aria-label="Primary">
      <button class="button ghost small nav-button" data-page="home" type="button">Home</button>
      <button class="button ghost small nav-button" data-page="config" type="button">Config</button>
      <button class="button ghost small nav-button" data-page="downloads" type="button">Downloads</button>
      <button class="button ghost small nav-button" data-page="search" type="button">Search</button>
      <button class="button ghost small nav-button" data-page="history" type="button">History</button>
      <button class="button ghost small nav-button" data-page="logs" type="button">Logs</button>
      <div id="nav-actions" class="nav-actions"></div>
    </nav>
    <div class="top-actions" id="top-actions">
      <button id="refresh-all" class="button">Refresh</button>
      <button id="toggle-theme" class="button ghost">Light mode</button>
      <a class="button ghost" href="/docs" target="_blank" rel="noopener">OpenAPI</a>
    </div>
  </header>

  <main class="layout">
    <section class="panel" id="run-panel" data-page="home">
      <div class="panel-title">Run Controls</div>
      <div class="stack">
        <div class="group">
          <div class="group-title">Playlists</div>
          <div class="row">
            <button id="run-playlists" class="button">Run Playlists</button>
          </div>
        </div>

        <div class="group">
          <div class="group-title">Single URL</div>
          <label class="field">
            <span>Video URL</span>
            <input id="run-single-url" type="text" placeholder="https://www.youtube.com/watch?v=...">
          </label>
        <label class="field">
          <span>Destination</span>
          <div class="row">
            <input id="run-destination" type="text" placeholder="downloads">
            <button id="browse-run-destination" class="button ghost small" type="button">Browse</button>
          </div>
        </label>
        <div class="row">
          <label class="field">
            <span>Format override</span>
            <select id="run-format">
              <option value="">(config default)</option>
              <option value="webm">webm</option>
              <option value="mp4">mp4</option>
              <option value="mkv">mkv</option>
              <option value="mp3">mp3</option>
            </select>
          </label>
          <label class="field">
            <span>JS runtime override</span>
            <input id="run-js-runtime" type="text" placeholder="node:/usr/bin/node">
          </label>
          </div>
        <div class="row">
          <button id="run-single" class="button">Run Single URL</button>
          <a id="run-single-download" class="button ghost small" href="#" aria-disabled="true">Download last</a>
        </div>
      </div>

        <div id="run-message" class="notice" role="status"></div>
      </div>
    </section>

    <section class="panel" id="status-panel" data-page="home">
      <div class="panel-title">Status</div>
      <div class="stack">
        <div class="row">
          <span class="chip" id="status-running">idle</span>
          <span class="meta" id="status-run-id">run: -</span>
        </div>
        <div class="row">
          <div class="stat">
            <span class="label">Started</span>
            <span id="status-started">-</span>
          </div>
          <div class="stat">
            <span class="label">Finished</span>
            <span id="status-finished">-</span>
          </div>
        </div>
        <div class="row">
          <div class="stat">
            <span class="label">Success</span>
            <span id="status-success">0</span>
          </div>
          <div class="stat">
            <span class="label">Failed</span>
            <span id="status-failed">0</span>
          </div>
        </div>
        <div class="row">
          <div class="stat">
            <span class="label">Active playlist</span>
            <span id="status-playlist">-</span>
          </div>
          <div class="stat">
            <span class="label">Active video</span>
            <span id="status-video">-</span>
          </div>
        </div>
        <div class="row">
          <div class="stat">
            <span class="label">Last completed</span>
            <span id="status-last-completed">-</span>
          </div>
          <div class="stat">
            <span class="label">Playlist progress</span>
            <span id="status-playlist-progress-text">-</span>
          </div>
        </div>
        <div class="progress">
          <div id="status-playlist-progress-bar" class="progress-bar"></div>
        </div>
        <div id="status-video-progress" class="stack hidden">
          <div class="row">
            <div class="stat">
              <span class="label">Video progress</span>
              <span id="status-video-progress-text">-</span>
            </div>
            <span id="status-video-progress-meta" class="meta">-</span>
          </div>
          <div class="progress">
            <div id="status-video-progress-bar" class="progress-bar"></div>
          </div>
        </div>
        <div class="row">
          <span class="label">Last error</span>
          <span id="status-error" class="meta">-</span>
        </div>
        <div class="row version-block">
          <div class="stat">
            <span class="label">Version</span>
            <div class="meta">
              <div id="status-version-app">App -</div>
              <div id="status-version-ytdlp">yt-dlp -</div>
              <div id="status-version-python">Py -</div>
            </div>
          </div>
          <div class="stat">
            <span class="label">Update</span>
            <span id="status-update" class="meta">-</span>
          </div>
        </div>
      </div>
    </section>

    <section class="panel" id="schedule-panel" data-page="home">
      <div class="panel-title">Schedule</div>
      <div class="stack">
        <div class="row">
          <label class="field inline">
            <span>Enabled</span>
            <input id="schedule-enabled" type="checkbox">
          </label>
          <label class="field inline">
            <span>Interval (hours)</span>
            <input id="schedule-interval" type="number" min="1" step="1" value="6">
          </label>
          <label class="field inline">
            <span>Run on startup</span>
            <input id="schedule-startup" type="checkbox">
          </label>
        </div>
        <div class="row">
          <button id="schedule-save" class="button">Save Schedule</button>
          <button id="schedule-run-now" class="button ghost">Run now</button>
          <div id="schedule-message" class="notice" role="status"></div>
        </div>
        <div class="row">
          <div class="stat">
            <span class="label">Last run</span>
            <span id="schedule-last-run">-</span>
          </div>
          <div class="stat">
            <span class="label">Next run</span>
            <span id="schedule-next-run">-</span>
          </div>
        </div>
        <div class="notice">Scheduled runs will not interrupt or overlap manual runs.</div>
      </div>
    </section>

    <section class="panel" id="metrics-panel" data-page="home">
      <div class="panel-title">Metrics</div>
      <div class="row">
        <div class="stat">
          <span class="label">Downloads files</span>
          <span id="metrics-downloads-count">-</span>
        </div>
        <div class="stat">
          <span class="label">Downloads size</span>
          <span id="metrics-downloads-size">-</span>
        </div>
        <div class="stat">
          <span class="label">Disk free</span>
          <span id="metrics-disk-free">-</span>
        </div>
        <div class="stat">
          <span class="label">Disk total</span>
          <span id="metrics-disk-total">-</span>
        </div>
      </div>
      <div class="row">
        <span id="metrics-message" class="notice"></span>
      </div>
    </section>

    <section class="panel full" id="config-panel" data-page="config">
      <div class="panel-title">Config Editor</div>
      <div class="stack">
        <div class="group">
          <div class="group-title">Config File</div>
          <div class="row">
            <label class="field">
              <span>Config path (server)</span>
              <input id="config-path" type="text" placeholder="config/config.json">
            </label>
            <button id="browse-config-path" class="button ghost">Browse</button>
            <button id="load-config-path" class="button">Load</button>
          </div>
          <div class="notice">Path changes apply globally on the server.</div>
        </div>

        <div class="group">
          <div class="group-title">General</div>
          <div class="grid two">
            <label class="field">
              <span>Playlist check interval (minutes)</span>
              <input id="cfg-poll-interval" type="number" min="1" step="1">
              <div class="notice">Checks YouTube playlists for new items (not UI refresh timing).</div>
            </label>
            <label class="field">
              <span>Upload date format</span>
              <input id="cfg-upload-date-format" type="text" placeholder="MM-YYYY">
            </label>
            <label class="field">
              <span>Filename template</span>
              <input id="cfg-filename-template" type="text" placeholder="%(title)s - %(uploader)s - %(upload_date)s.%(ext)s">
            </label>
            <label class="field">
              <span>Final format</span>
              <select id="cfg-final-format">
                <option value="">(not set)</option>
                <option value="webm">webm (default)</option>
                <option value="mp4">mp4</option>
                <option value="mkv">mkv</option>
                <option value="mp3">mp3</option>
              </select>
            </label>
            <label class="field">
              <span>JS runtime</span>
              <input id="cfg-js-runtime" type="text" placeholder="node:/usr/bin/node">
            </label>
            <label class="field">
              <span>Single download folder</span>
              <div class="row">
                <input id="cfg-single-download-folder" type="text" placeholder="downloads">
                <button id="browse-single-download" class="button ghost small">Browse</button>
              </div>
            </label>
          </div>
        </div>

        <div class="group">
          <div class="group-title">Telegram</div>
          <div class="grid two">
            <label class="field">
              <span>Bot token</span>
              <div class="row">
                <input id="cfg-telegram-token" type="password">
                <button id="toggle-telegram-token" class="button ghost small" type="button">Show</button>
              </div>
            </label>
            <label class="field">
              <span>Chat ID</span>
              <input id="cfg-telegram-chat" type="text">
            </label>
          </div>
        </div>

        <div class="group">
          <div class="group-title">Accounts</div>
          <div id="accounts-list" class="stack"></div>
          <button id="add-account" class="button ghost">Add account</button>
        </div>

        <div class="group">
          <div class="group-title">Playlists</div>
          <div id="playlists-list" class="stack"></div>
          <button id="add-playlist" class="button ghost">Add playlist</button>
        </div>

        <div class="group">
          <div class="group-title">yt-dlp Options (JSON)</div>
          <label class="field">
            <span>Options</span>
            <textarea id="cfg-yt-dlp-opts" rows="6" placeholder='{"format_sort": ["res", "codec"]}'></textarea>
          </label>
        </div>

        <div class="group">
          <div class="group-title">Maintenance</div>
          <div class="row">
            <button id="ytdlp-update" class="button ghost">Update yt-dlp</button>
            <div id="ytdlp-update-message" class="notice" role="status"></div>
          </div>
        </div>

        <div class="row">
          <button id="save-config" class="button">Save Config</button>
          <button id="reset-config" class="button ghost">Reset</button>
          <div id="config-message" class="notice" role="status"></div>
        </div>
      </div>
    </section>

    <section class="panel full page-full" id="logs-panel" data-page="logs">
      <div class="panel-title">Logs</div>
      <div class="row">
        <label class="field inline">
          <span>Lines</span>
          <input id="logs-lines" type="number" min="1" max="5000" value="200">
        </label>
        <button id="logs-refresh" class="button ghost">Refresh</button>
        <label class="field inline">
          <span>Auto</span>
          <input id="logs-auto" type="checkbox" checked>
        </label>
      </div>
      <pre id="logs-output" class="log-output" aria-live="polite"></pre>
    </section>

    <section class="panel full page-full" id="downloads-panel" data-page="downloads">
      <div class="panel-title">Downloads</div>
      <div class="row">
        <button id="downloads-refresh" class="button ghost">Refresh</button>
        <button id="cleanup-temp" class="button ghost">Clear temporary files</button>
        <div id="downloads-message" class="notice" role="status"></div>
      </div>
      <div class="row">
        <button class="button ghost small filters-toggle" data-target="downloads-filters" type="button">Filters</button>
      </div>
      <div class="filters-block" id="downloads-filters">
        <div class="row filters">
          <label class="field inline">
            <span>Search</span>
            <input id="downloads-search" type="text" placeholder="name or path">
          </label>
          <label class="field inline">
            <span>Limit</span>
            <input id="downloads-limit" type="number" min="1" max="5000" value="50">
          </label>
          <button id="downloads-apply" class="button ghost">Apply</button>
          <button id="downloads-clear" class="button ghost">Clear</button>
        </div>
      </div>
      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Modified</th>
              <th>Size</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="downloads-body"></tbody>
        </table>
      </div>
    </section>

    <section class="panel full page-full" id="search-panel" data-page="search">
      <div class="panel-title">Media Search Console</div>
      <div class="stack">
        <div class="group">
          <div class="group-title">Create Search Request</div>
          <div class="grid two">
            <label class="field">
              <span>Artist</span>
              <input id="search-artist" type="text" placeholder="Artist name">
            </label>
            <label class="field">
              <span>Album (optional)</span>
              <input id="search-album" type="text" placeholder="Album title">
            </label>
            <label class="field">
              <span>Track (optional)</span>
              <input id="search-track" type="text" placeholder="Track title">
            </label>
            <label class="field">
              <span>Intent</span>
              <select id="search-intent">
                <option value="track">track</option>
                <option value="album">album</option>
              </select>
            </label>
            <label class="field">
              <span>Minimum match score</span>
              <input id="search-min-score" type="number" min="0" max="1" step="0.01" value="0.92">
            </label>
            <label class="field">
              <span>Source priority</span>
              <input id="search-source-priority" type="text" value="bandcamp,youtube_music,soundcloud">
            </label>
            <label class="field">
              <span>Duration hint (sec, optional)</span>
              <input id="search-duration-hint" type="number" min="0" step="1">
            </label>
            <label class="field">
              <span>Quality min bitrate (kbps, optional)</span>
              <input id="search-quality-min" type="number" min="0" step="1">
            </label>
            <label class="field">
              <span>Max candidates per source</span>
              <input id="search-max-candidates" type="number" min="1" step="1" value="5">
            </label>
            <label class="field">
              <span>Created by (optional)</span>
              <input id="search-created-by" type="text" value="webui">
            </label>
          </div>
          <div class="row">
            <label class="field inline">
              <span>Include albums</span>
              <input id="search-include-albums" type="checkbox" checked>
            </label>
            <label class="field inline">
              <span>Include singles</span>
              <input id="search-include-singles" type="checkbox" checked>
            </label>
            <label class="field inline">
              <span>Lossless only</span>
              <input id="search-lossless-only" type="checkbox">
            </label>
          </div>
          <div class="row">
            <button id="search-create" class="button">Create Request</button>
            <div id="search-create-message" class="notice" role="status"></div>
          </div>
        </div>

        <div class="group">
          <div class="group-title">Search Requests</div>
          <div class="row">
            <button id="search-requests-refresh" class="button ghost">Refresh</button>
            <div id="search-requests-message" class="notice" role="status"></div>
          </div>
          <div class="table-wrap">
            <table class="table">
              <thead>
                <tr>
                  <th>Request ID</th>
                  <th>Artist / Album / Track</th>
                  <th>Intent</th>
                  <th>Status</th>
                  <th>Created</th>
                  <th>Error</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="search-requests-body"></tbody>
            </table>
          </div>
        </div>

        <div class="group">
          <div class="group-title">Search Items</div>
          <div class="row">
            <span class="meta" id="search-selected-request">Selected request: -</span>
            <button id="search-items-refresh" class="button ghost small">Refresh Items</button>
            <div id="search-items-message" class="notice" role="status"></div>
          </div>
          <div class="table-wrap">
            <table class="table">
              <thead>
                <tr>
                  <th>Item ID</th>
                  <th>Position</th>
                  <th>Artist / Album / Track</th>
                  <th>Status</th>
                  <th>Chosen source</th>
                  <th>Chosen score</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="search-items-body"></tbody>
            </table>
          </div>
        </div>

        <div class="group">
          <div class="group-title">Candidates</div>
          <div class="row">
            <span class="meta" id="search-selected-item">Selected item: -</span>
            <button id="search-candidates-refresh" class="button ghost small">Refresh Candidates</button>
            <div id="search-candidates-message" class="notice" role="status"></div>
          </div>
          <div class="table-wrap">
            <table class="table">
              <thead>
                <tr>
                  <th>Source</th>
                  <th>Title</th>
                  <th>Detected artist / album / track</th>
                  <th>Duration</th>
                  <th>Artist score</th>
                  <th>Track score</th>
                  <th>Album score</th>
                  <th>Duration score</th>
                  <th>Source mod</th>
                  <th>Penalty</th>
                  <th>Final score</th>
                  <th>Rank</th>
                </tr>
              </thead>
              <tbody id="search-candidates-body"></tbody>
            </table>
          </div>
        </div>

        <div class="group">
          <div class="group-title">Unified Download Queue</div>
          <div class="row">
            <button id="download-jobs-refresh" class="button ghost">Refresh</button>
            <div id="download-jobs-message" class="notice" role="status"></div>
          </div>
          <div class="table-wrap">
            <table class="table">
              <thead>
                <tr>
                  <th>Job ID</th>
                  <th>Origin</th>
                  <th>Source</th>
                  <th>Media intent</th>
                  <th>Status</th>
                  <th>Attempts</th>
                  <th>Created</th>
                  <th>Last error</th>
                </tr>
              </thead>
              <tbody id="download-jobs-body"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <section class="panel full page-full" id="history-panel" data-page="history">
      <div class="panel-title">History</div>
      <div class="row">
        <button class="button ghost small filters-toggle" data-target="history-filters" type="button">Filters</button>
        <button id="history-refresh" class="button ghost">Refresh</button>
      </div>
      <div class="filters-block" id="history-filters">
        <div class="row filters">
          <label class="field inline">
            <span>Search</span>
            <input id="history-search" type="text" placeholder="title or filename">
          </label>
          <label class="field inline">
            <span>Playlist</span>
            <input id="history-playlist" type="text" placeholder="playlist id">
          </label>
          <label class="field inline">
            <span>From</span>
            <input id="history-from" type="date">
          </label>
          <label class="field inline">
            <span>To</span>
            <input id="history-to" type="date">
          </label>
        </div>
        <div class="row filters">
          <label class="field inline">
            <span>Limit</span>
            <input id="history-limit" type="number" min="1" max="5000" value="50">
          </label>
          <label class="field inline">
            <span>Sort</span>
            <select id="history-sort">
              <option value="date">date</option>
              <option value="title">title</option>
              <option value="size">size</option>
            </select>
          </label>
          <label class="field inline">
            <span>Dir</span>
            <select id="history-dir">
              <option value="desc">desc</option>
              <option value="asc">asc</option>
            </select>
          </label>
          <label class="field inline">
            <span>Internal paths</span>
            <input id="history-show-paths" type="checkbox">
          </label>
          <button id="history-apply" class="button ghost">Apply</button>
          <button id="history-clear" class="button ghost">Clear</button>
        </div>
      </div>
      <div id="history-message" class="notice" role="status"></div>
      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>Video ID</th>
              <th>Playlist ID</th>
              <th>Downloaded At</th>
              <th>Filepath</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="history-body"></tbody>
        </table>
      </div>
    </section>
  </main>

  <div id="browser-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="browser-title">
    <div class="modal-card">
      <div class="row space-between">
        <div id="browser-title" class="panel-title">Server Browser</div>
        <button id="browser-close" class="button ghost small">Close</button>
      </div>
      <div class="row space-between">
        <div class="meta" id="browser-path">/</div>
        <button id="browser-up" class="button ghost small">Up</button>
      </div>
      <div id="browser-list" class="browser-list"></div>
      <div class="row space-between">
        <div class="meta" id="browser-selected">No selection</div>
        <button id="browser-select" class="button small">Use this path</button>
      </div>
    </div>
  </div>

  <div id="oauth-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="oauth-title">
    <div class="modal-card">
      <div class="row space-between">
        <div id="oauth-title" class="panel-title">OAuth Helper</div>
        <button id="oauth-close" class="button ghost small">Close</button>
      </div>
      <div class="stack">
        <div class="notice">Open the authorization URL, approve access, then paste the code below.</div>
        <div class="row">
          <span class="label">Account</span>
          <span id="oauth-account" class="meta">-</span>
        </div>
        <label class="field">
          <span>Authorization URL</span>
          <div class="row">
            <input id="oauth-url" type="text" readonly>
            <button id="oauth-open" class="button ghost small" type="button">Open</button>
          </div>
        </label>
        <label class="field">
          <span>Authorization code</span>
          <input id="oauth-code" type="text" placeholder="Paste the code here">
        </label>
        <div class="row">
          <button id="oauth-complete" class="button">Complete OAuth</button>
          <div id="oauth-message" class="notice" role="status"></div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
